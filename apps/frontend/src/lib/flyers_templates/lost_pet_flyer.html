<!doctype html>
<html lang="es">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Flyer Mascota Perdida - {{pet_name}}</title>
		<style>
			@page {
				size: A4;
				margin: 0;
			}

			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family: Arial, sans-serif;
				width: 210mm;
				height: 297mm;
				background: white;
				position: relative;
				overflow: hidden;
			}

			.flyer-container {
				width: 100%;
				height: 100%;
				position: relative;
				padding: 15mm;
				display: flex;
				flex-direction: column;
			}

			.header {
				text-align: center;
				margin-bottom: 10mm;
			}

			.lost-banner {
				background: #ff4444;
				color: white;
				padding: 8mm;
				font-size: 24pt;
				font-weight: bold;
				text-align: center;
				border-radius: 5mm;
				margin-bottom: 10mm;
			}

			.pet-info {
				display: flex;
				gap: 10mm;
				margin-bottom: 10mm;
				flex: 1;
			}

			.pet-photo {
				flex: 1;
				border: 2px solid #ccc;
				border-radius: 5mm;
				overflow: hidden;
				min-height: 80mm;
				display: flex;
				align-items: center;
				justify-content: center;
				background: #f9f9f9;
			}

			.pet-photo img {
				max-width: 100%;
				max-height: 100%;
				object-fit: cover;
			}

			.pet-details {
				flex: 1;
				display: flex;
				flex-direction: column;
				gap: 3mm;
			}

			.detail-row {
				display: flex;
				margin-bottom: 2mm;
			}

			.detail-label {
				font-weight: bold;
				min-width: 35mm;
				color: #333;
			}

			.detail-value {
				flex: 1;
				border-bottom: 1px dotted #ccc;
				padding: 1mm 0;
			}

			.qr-section {
				display: flex;
				align-items: center;
				justify-content: center;
				gap: 10mm;
				margin: 10mm 0;
			}

			.qr-code {
				width: 40mm;
				height: 40mm;
				border: 2px solid #333;
				display: flex;
				align-items: center;
				justify-content: center;
				background: #f9f9f9;
			}

			.qr-code img {
				max-width: 100%;
				max-height: 100%;
			}

			.qr-text {
				flex: 1;
				text-align: center;
			}

			.contact-info {
				background: #e8f4f8;
				padding: 5mm;
				border-radius: 3mm;
				margin: 5mm 0;
			}

			.contact-title {
				font-weight: bold;
				font-size: 14pt;
				margin-bottom: 3mm;
				color: #2c5aa0;
			}

			.reward-section {
				background: #fff3cd;
				padding: 5mm;
				border-radius: 3mm;
				margin: 5mm 0;
				border-left: 4mm solid #ffc107;
			}

			.reward-title {
				font-weight: bold;
				color: #856404;
				margin-bottom: 2mm;
			}

			.footer {
				margin-top: auto;
				text-align: center;
				font-size: 10pt;
				color: #666;
			}

			/* Tabs para cortar */
			.cut-tabs {
				position: absolute;
				bottom: 0;
				left: 0;
				right: 0;
				height: 15mm;
				background: white;
				border-top: 1px dashed #ccc;
			}

			.tab {
				position: absolute;
				bottom: 0;
				width: 25mm;
				height: 12mm;
				background: #ff4444;
				color: white;
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: 8pt;
				font-weight: bold;
				transform: rotate(-90deg);
				transform-origin: center;
				border-radius: 2mm 2mm 0 0;
			}

			.tab.left {
				left: 10mm;
			}

			.tab.right {
				right: 10mm;
			}

			/* Estilos para edición */
			[contenteditable] {
				outline: 1px dashed #007bff;
				min-height: 1em;
			}

			[contenteditable]:focus {
				outline: 2px solid #007bff;
				background: #f8f9fa;
			}

			.editable-field {
				display: inline-block;
				min-width: 50px;
			}

			/* Estilos de impresión */
			@media print {
				body {
					-webkit-print-color-adjust: exact;
					color-adjust: exact;
				}

				[contenteditable] {
					outline: none !important;
					background: transparent !important;
				}
			}

			/* Grid de fondo sutil para alineación */
			.alignment-grid {
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				pointer-events: none;
				z-index: -1;
				opacity: 0.1;
			}

			.alignment-grid::before,
			.alignment-grid::after {
				content: '';
				position: absolute;
				background: #ccc;
			}

			.alignment-grid::before {
				top: 50%;
				left: 0;
				right: 0;
				height: 0.5mm;
			}

			.alignment-grid::after {
				top: 0;
				bottom: 0;
				left: 50%;
				width: 0.5mm;
			}
		</style>
	</head>
	<body>
		<div class="flyer-container">
			<!-- Grid de alineación (solo visible en pantalla) -->
			<div class="alignment-grid"></div>

			<!-- Header -->
			<div class="header">
				<div class="lost-banner" contenteditable="true">¡MASCOTA PERDIDA!</div>
			</div>

			<!-- Información de la mascota -->
			<div class="pet-info">
				<!-- Foto de la mascota -->
				<div class="pet-photo">
					<img
						src="{{pet_picture}}"
						alt="Foto de {{pet_name}}"
						onerror="this.style.display='none'"
					/>
					<div style="text-align: center; color: #666; font-size: 12pt" contenteditable="true">
						Foto de la mascota
					</div>
				</div>

				<!-- Detalles de la mascota -->
				<div class="pet-details">
					<div class="detail-row">
						<span class="detail-label">Nombre:</span>
						<span class="detail-value editable-field" contenteditable="true">{{pet_name}}</span>
					</div>

					<div class="detail-row">
						<span class="detail-label">Tipo:</span>
						<span class="detail-value editable-field" contenteditable="true">{{pet_type}}</span>
					</div>

					<div class="detail-row">
						<span class="detail-label">Edad:</span>
						<span class="detail-value editable-field" contenteditable="true">{{pet_age}}</span>
					</div>

					<div class="detail-row">
						<span class="detail-label">Raza:</span>
						<span class="detail-value editable-field" contenteditable="true">{{pet_breed}}</span>
					</div>

					<div class="detail-row">
						<span class="detail-label">Color:</span>
						<span class="detail-value editable-field" contenteditable="true">{{pet_color}}</span>
					</div>

					<div class="detail-row">
						<span class="detail-label">Sexo:</span>
						<span class="detail-value editable-field" contenteditable="true">{{pet_gender}}</span>
					</div>

					<div class="detail-row">
						<span class="detail-label">Última vez visto:</span>
						<span class="detail-value editable-field" contenteditable="true"
							>{{pet_last_seen}}</span
						>
					</div>

					<div class="detail-row">
						<span class="detail-label">Lugar:</span>
						<span class="detail-value editable-field" contenteditable="true">{{pet_location}}</span>
					</div>

					<div style="margin-top: 5mm">
						<strong>Descripción:</strong><br />
						<div
							contenteditable="true"
							style="border: 1px solid #ccc; padding: 2mm; min-height: 15mm; margin-top: 2mm"
						>
							{{pet_description}}
						</div>
					</div>
				</div>
			</div>

			<!-- Código QR -->
			<div class="qr-section">
				<div class="qr-code">
					<img src="{{qr_code_url}}" alt="QR Code" onerror="this.innerHTML='QR Code'" />
				</div>
				<div class="qr-text">
					<strong>¡Escanea para más info!</strong><br />
					<small>www.petto.com/qr/{{pet_id}}</small>
				</div>
			</div>

			<!-- Información de contacto -->
			<div class="contact-info">
				<div class="contact-title">¡Si encuentras a mi mascota, por favor contacta!</div>
				<div style="display: flex; gap: 10mm; margin-top: 3mm">
					<div style="flex: 1">
						<strong>Dueño:</strong> <span contenteditable="true">{{owner_name}}</span><br />
						<strong>Teléfono:</strong> <span contenteditable="true">{{owner_phone}}</span><br />
						<strong>Email:</strong> <span contenteditable="true">{{owner_email}}</span>
					</div>
					<div style="flex: 1">
						<strong>Dirección:</strong><br />
						<span contenteditable="true">{{owner_address}}</span>
					</div>
				</div>
			</div>

			<!-- Sección de recompensa (opcional) -->
			<div class="reward-section" style="display: {{show_reward}};">
				<div class="reward-title">¡RECOMPENSA!</div>
				<div contenteditable="true">{{reward_amount}}</div>
			</div>

			<!-- Footer -->
			<div class="footer">
				<div contenteditable="true">Creado con ❤️ por Petto - Reunamos mascotas perdidas</div>
			</div>
		</div>

		<!-- Tabs para cortar -->
		<div class="cut-tabs">
			<div class="tab left" contenteditable="true">{{owner_phone}}</div>
			<div class="tab right" contenteditable="true">{{owner_phone}}</div>
		</div>

		<script>
			// Función para reemplazar placeholders con datos reales
			function populateTemplate(data) {
				const elements = document.querySelectorAll('[contenteditable]');
				elements.forEach((el) => {
					if (el.textContent.includes('{{') && el.textContent.includes('}}')) {
						// Si contiene placeholders, mantener editable
						return;
					}
				});

				// Reemplazar placeholders en el HTML
				document.body.innerHTML = document.body.innerHTML.replace(
					/\{\{(\w+)\}\}/g,
					(match, key) => {
						return data[key] || match;
					}
				);
			}

			// Función para exportar como PDF (requiere librería adicional)
			function exportAsPDF() {
				// Implementar exportación a PDF
				alert('Función de exportación a PDF - Implementar con librería como jsPDF o html2pdf');
			}

			// Función para imprimir
			function printFlyer() {
				window.print();
			}

			// Auto-rellenar si hay datos disponibles
			window.addEventListener('load', function () {
				// Aquí se pueden cargar datos desde una API o localStorage
				const urlParams = new URLSearchParams(window.location.search);
				const petId = urlParams.get('pet_id');

				if (petId) {
					// Cargar datos de la mascota
					fetch(`/api/pets/${petId}`)
						.then((response) => response.json())
						.then((data) => {
							populateTemplate({
								pet_name: data.name,
								pet_type: data.pet_type,
								pet_age: data.age || '',
								pet_breed: data.breed || '',
								pet_color: data.color || '',
								pet_gender: data.gender || '',
								pet_last_seen: data.last_seen || '',
								pet_location: data.location || '',
								pet_description: data.notes || '',
								pet_picture: data.picture,
								qr_code_url: `/api/qrcode/${petId}`,
								owner_name: `${data.owner.first_name} ${data.owner.last_name}`,
								owner_phone: data.owner.phone,
								owner_email: data.owner.email,
								owner_address: data.owner.full_address,
								reward_amount: data.owner.recovery_bounty ? `$${data.owner.recovery_bounty}` : '',
								show_reward: data.owner.recovery_bounty ? 'block' : 'none',
								pet_id: petId
							});
						})
						.catch((error) => console.error('Error loading pet data:', error));
				}
			});
		</script>
	</body>
</html>
